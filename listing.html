
<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>F√∂rr√•d ‚Äì StoreShare</title>
    <link rel="stylesheet" href="./style.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body>

<header class="fixed-header" role="banner">
  <div class="fixed-header-inner">
    <img class="fixed-logo" 
         src="./assets/storeshare-logo-132.png" 
         srcset="./assets/storeshare-logo-132.png 1x, ./assets/storeshare-logo-264.png 2x, ./assets/storeshare-logo-396.png 3x"
         width="56" height="56" alt="StoreShare">
    <span class="fixed-brand">StoreShare</span>
    <nav class="auth-links"></nav>
  </div>
</header>

    <a class="corner-logo hide" href="./index.html" id="cornerLogo">
      <img src="./assets/storeshare-logo-emblem.svg" alt="StoreShare"/>
      <span>StoreShare</span>
    </a>
    <div class="container" style="max-width:1000px">
      <div id="content"></div>
    </div>
    <script>
      // Show corner logo only near very top
      const cornerLogo = document.getElementById('cornerLogo')
      window.addEventListener('scroll', () => {
        const y = window.scrollY || document.documentElement.scrollTop
        if (y < 40) cornerLogo.classList.remove('hide'); else cornerLogo.classList.add('hide')
      }, { passive:true })

      function seedListings(){ return [
        {id:'1',title:'Uppv√§rmt f√∂rr√•d med avfuktare',description:'Perfekt f√∂r elektronik och m√∂bler. Ligger n√§ra centrum.',pricePerMonth:600,sizeSqm:6,heated:true,dehumidifier:true,photos:['./assets/garage1.avif'],location:{address:'Rosenlundsgatan ‚Ä¢ G√∂teborg',lat:57.7089,lng:11.9746}},
        {id:'2',title:'K√§llarf√∂rr√•d i villa',description:'Svalt √•ret runt. Inte uppv√§rmt.',pricePerMonth:350,sizeSqm:4,heated:false,dehumidifier:false,photos:['./assets/garage2.webp'],location:{address:'Sveav√§gen ‚Ä¢ Stockholm',lat:59.3293,lng:18.0686}}
      ]}
      function loadUserListings(){ try{ return JSON.parse(localStorage.getItem('storeshare:demo:listings')||'[]') }catch(e){ return [] } }
      function loadListings(){ return seedListings().concat(loadUserListings()) }

      const params = new URLSearchParams(location.search)
      const id = params.get('id')
      const l = loadListings().find(x => String(x.id) === String(id))

      const el = document.getElementById('content')
      if(!l){ el.innerHTML = '<div class="glass" style="padding:16px">F√∂rr√•d hittades inte.</div>'; }
      else {
        el.innerHTML = `
          <div class="gallery">
            <img src="${l.photos[0]}" alt="${l.title}" style="width:100%;height:360px;object-fit:cover;display:block"/>
          </div>
          <div class="two-col" style="margin-top:16px; grid-template-columns:1.2fr .8fr">
            <div>
              <h1 style="margin:.4em 0">${l.title}</h1>
              <div class="badges">
                <span class="badge">${l.sizeSqm} m¬≤</span>
                <span class="badge">${l.heated ? 'Uppv√§rmt' : 'Ej uppv√§rmt'}</span>
                <span class="badge">${l.dehumidifier ? 'Avfuktare' : 'Ingen avfuktare'}</span>
              </div>
              <p style="margin-top:12px">${l.description || ''}</p>
              <div class="price">${l.pricePerMonth} kr/m√•n</div>
              <div style="color:#555;margin-top:6px">${l.location.address}</div>
              <div class="row" style="margin-top:14px">
                <button class="btn" id="rentBtn">F√∂rfr√•gan (Swish placeholder)</button>
                <a class="btn secondary" href="./search.html">Tillbaka till s√∂k</a>
              </div>
            </div>
            <div>
              <div id="map" style="height:300px;border-radius:12px;overflow:hidden;border:1px solid #0001"></div>
            </div>
          </div>
        `
        const map = L.map('map').setView([l.location.lat, l.location.lng], 13)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map)
        L.marker([l.location.lat, l.location.lng]).addTo(map).bindPopup(l.title)
      }
    </script>
      <script src="./app.js"></script>
  <div id="detailActions" style="margin:16px"></div>
  
<nav class="bottom-nav">
  <a href="index.html" ><span aria-hidden="true" style="font-size:1.15rem">üß≠</span><span>Start</span></a>
  <a href="search.html" ><span aria-hidden="true" style="font-size:1.15rem">üîé</span><span>S√∂k</span></a>
  <a href="create.html" ><span aria-hidden="true" style="font-size:1.15rem">üè†</span><span>Hyr ut</span></a>
  <a href="profile.html" ><span aria-hidden="true" style="font-size:1.15rem">üë§</span><span>Profil</span></a>
</nav>


<script>
function getSession(){ try{ return JSON.parse(localStorage.getItem('storeshare:session')||'null') }catch(e){ return null } }
function setSession(sess){ if(sess){ localStorage.setItem('storeshare:session', JSON.stringify(sess)) } else { localStorage.removeItem('storeshare:session') } }
function updateAuthUI(){
  const nav = document.querySelector('.auth-links'); if(!nav) return;
  const sess = getSession();
  if(sess){
    nav.innerHTML = `<span class="user-chip" title="${sess.email}">Inloggad som ${sess.name||sess.email}</span>
                     <button class="btn ghost" id="logoutBtn">Logga ut</button>`;
    const btn = nav.querySelector('#logoutBtn');
    if(btn){ btn.addEventListener('click', ()=>{ setSession(null); location.href='./index.html' }) }
  }else{
    nav.innerHTML = `<a class="btn ghost" href="./login.html">Logga in</a>
                     <a class="btn" href="./signup.html">Skapa konto</a>`;
  }
}
document.addEventListener('DOMContentLoaded', updateAuthUI);
// Intercept Hyr ut & Profil if not logged in
document.addEventListener('click', (e)=>{
  const link = e.target.closest('a[href$="create.html"], a[href$="profile.html"]');
  if(!link) return;
  const sess = getSession();
  if(!sess){
    e.preventDefault();
    const url = new URL(link.getAttribute('href'), location.href);
    const ret = encodeURIComponent(url.pathname.split('/').pop());
    location.href = `./login.html?return=${ret}`;
  }
});
</script>

<script>
// Save rental for this user (demo)
(function(){
  function getSession(){ try{ return JSON.parse(localStorage.getItem('storeshare:session')||'null') }catch(e){ return null } }
  function saveRent(email, id){
    const k='storeshare:rents:'+email; let arr=[]; try{ arr=JSON.parse(localStorage.getItem(k)||'[]') }catch(e){}
    if(!arr.includes(String(id))) arr.push(String(id));
    localStorage.setItem(k, JSON.stringify(arr));
  }
  const btn = document.getElementById('rentBtn');
  if(btn){
    btn.addEventListener('click', ()=>{
      const sess = getSession();
      if(!sess){ location.href='./login.html?return='+encodeURIComponent(location.pathname.split('/').pop()+location.search); return; }
      const id = new URLSearchParams(location.search).get('id');
      saveRent(sess.email, id);
      btn.textContent = 'F√∂rfr√•gan skickad!';
      btn.disabled = true;
    })
  }
})();
</script>

<script>
// Dynamic spacer to avoid bottom-nav covering content
(function(){
  const nav = document.querySelector('.bottom-nav');
  if(!nav) return;
  let spacer = document.getElementById('navSpacer');
  if(!spacer){
    spacer = document.createElement('div');
    spacer.id = 'navSpacer';
    spacer.style.width = '100%';
    spacer.style.height = '0px';
    spacer.style.pointerEvents = 'none';
    document.body.appendChild(spacer);
  }
  function setSpacer(){
    const h = Math.ceil(nav.getBoundingClientRect().height || 0);
    const extra = 24; // breathing room
    spacer.style.height = (h + extra) + 'px';
    document.body.style.paddingBottom = (h + extra) + 'px';
  }
  const ro = new ResizeObserver(setSpacer);
  ro.observe(nav);
  window.addEventListener('orientationchange', setSpacer);
  window.addEventListener('resize', setSpacer);
  window.addEventListener('load', setSpacer);
  setSpacer();
})();
</script>

</body>
</html>
